<section class="section">
  <h1 class="has-text-centered title">Checkout</h1>
  <div class="container is-fluid shop-grid">
      <% @order.order_items.each do |item| %>
      <div class="shop-grid-item">        
        <%= image_tag item.product.image.url(:thumb) %>
        <p><%= item.product.name %></p>
        <div class="quantity">
          <span id="to-grow">Quantity: <%= item.quantity %></span>
          <p><%= link_to "Add|", order_item_add_path(:id => item), method: :post, class: "is-size-7"  %></p>
          <p><%= link_to "Subtract", order_item_reduce_path(:id => item), method: :post, class: "is-size-7" %></p>
        </div>
        <% if item.product.stock < item.quantity %>
            <span class="is-uppercase has-text-danger has-text-weight-bold">Not Enough Stock To Fill Request!</span>
          <% end %>
        <p>(Subtotal: <%= number_to_currency item.subtotal %>)</p>
        <%= link_to 'Remove item from cart', item, method: :delete, data: { confirm: 'Are you sure?' }, class: "button is-warning is-small" %>
      </div>
      <% end %>
    </div>
    <div class="has-text-centered">
      <h2 class="subtitle">Total: <%= number_to_currency @order.total %></h2>
    </div>
    <br>
    <div class="container is-fluid has-text-centered">
      <h2 class="subtitle">Payment and Shipping</h2>
      <%= form_for @order do |f| %>
        <h2>Choose your shipping address:</h2>
        <% if current_user.addresses.empty? %>
          <p><%= link_to 'Add a shipping address', new_address_path %></p>
        <% else %>
          <%= f.select :address_id, current_user.addresses.collect{|a| [a.to_s, a.id]} %>
          <p><%= link_to 'Add a different address', new_address_path %></p>
          <div class="column">
            <span><%= f.submit "Submit Order", class: "button is-primary" %></span>
            <span><%= link_to "Cancel Order", @order, data: { confirm: 'Are you sure?' }, method: :delete, class: "button is-danger" %></span>
          </div>
        <% end %>
      <% end %>
    </div>
</section>